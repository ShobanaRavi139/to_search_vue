import{r as m,A as Y,o,d as n,a as i,E as x,b as s,w as t,f as r,t as C,I as K,n as w,C as U,Q as j,j as z,i as d,c as h,T as G,m as W,k as J,e as c,F as X,g as Z,O as V}from"./app-aebcdfa6.js";import{_ as ee}from"./Modal-600c16ce.js";import{_ as oe}from"./DialogModal-a9cc4cbb.js";import{_ as R,a as L}from"./TextInput-328a3e8b.js";import{_ as q}from"./PrimaryButton-c2c67aa4.js";import{_ as D}from"./SecondaryButton-8e73c1d3.js";import{_ as te}from"./DangerButton-9a1df02a.js";import{_ as ne}from"./InputLabel-aaa674b5.js";import{_ as se}from"./_plugin-vue_export-helper-c27b6911.js";import{I as ae,F as re,B as ie}from"./index-dcd739bf.js";import"./SectionTitle-a91f7fce.js";import"./collapseMotion-cb1e5013.js";const ce={class:"mt-4"},le={__name:"ConfirmsPassword",props:{title:{type:String,default:"Confirm Password"},content:{type:String,default:"For your security, please confirm your password to continue."},button:{type:String,default:"Confirm"}},emits:["confirmed"],setup(e,{emit:u}){const f=u,p=m(!1),a=Y({password:"",error:"",processing:!1}),_=m(null),T=()=>{axios.get(route("password.confirmation")).then(y=>{y.data.confirmed?f("confirmed"):(p.value=!0,setTimeout(()=>_.value.focus(),250))})},b=()=>{a.processing=!0,axios.post(route("password.confirm"),{password:a.password}).then(()=>{a.processing=!1,g(),U().then(()=>f("confirmed"))}).catch(y=>{a.processing=!1,a.error=y.response.data.errors.password[0],_.value.focus()})},g=()=>{p.value=!1,a.password="",a.error=""};return(y,l)=>(o(),n("span",null,[i("span",{onClick:T},[x(y.$slots,"default")]),s(oe,{show:p.value,onClose:g},{title:t(()=>[r(C(e.title),1)]),content:t(()=>[r(C(e.content)+" ",1),i("div",ce,[s(R,{ref_key:"passwordInput",ref:_,modelValue:a.password,"onUpdate:modelValue":l[0]||(l[0]=S=>a.password=S),type:"password",class:"mt-1 block w-3/4",placeholder:"Password",autocomplete:"current-password",onKeyup:K(b,["enter"])},null,8,["modelValue","onKeyup"]),s(L,{message:a.error,class:"mt-2"},null,8,["message"])])]),footer:t(()=>[s(D,{onClick:g},{default:t(()=>[r(" Cancel ")]),_:1}),s(q,{class:w(["ms-3",{"opacity-25":a.processing}]),disabled:a.processing,onClick:b},{default:t(()=>[r(C(e.button),1)]),_:1},8,["class","disabled"])]),_:1},8,["show"])]))}},E=j(),k=m(!1),F=m(!1),B=m(!1),I=m(null),$=m(null),M=m([]),de=()=>{k.value=!0,V.post(route("two-factor.enable"),{},{preserveScroll:!0,onSuccess:()=>Promise.all([H(),N(),P()]),onFinish:()=>{k.value=!1,F.value=props.requiresConfirmation}})},H=()=>axios.get(route("two-factor.qr-code")).then(e=>{I.value=e.data.svg}),N=()=>axios.get(route("two-factor.secret-key")).then(e=>{$.value=e.data.secretKey}),P=()=>axios.get(route("two-factor.recovery-codes")).then(e=>{M.value=e.data}),ue=()=>{confirmationForm.post(route("two-factor.confirm"),{errorBag:"confirmTwoFactorAuthentication",preserveScroll:!0,preserveState:!0,onSuccess:()=>{F.value=!1,I.value=null,$.value=null}})},me=()=>{axios.post(route("two-factor.recovery-codes")).then(()=>P())},fe=()=>{B.value=!0,V.delete(route("two-factor.disable"),{preserveScroll:!0,onSuccess:()=>{B.value=!1,F.value=!1}})},pe=z({props:{requiresConfirmation:Boolean},components:{"a-input":ae,"a-form-item":re,"a-button":ie,ActionSection:ee,ConfirmsPassword:le,DangerButton:te,InputError:L,InputLabel:ne,PrimaryButton:q,SecondaryButton:D,TextInput:R},setup(e){const u=G({code:""}),f=W(()=>{var p;return!k.value&&((p=E.props.auth.user)==null?void 0:p.two_factor_enabled)});return J(f,()=>{f.value||(u.reset(),u.clearErrors())}),{props:e,page:E,enabling:k,confirming:F,disabling:B,qrCode:I,setupKey:$,recoveryCodes:M,confirmationForm:u,twoFactorEnabled:f,enableTwoFactorAuthentication:de,showQrCode:H,showSetupKey:N,showRecoveryCodes:P,confirmTwoFactorAuthentication:ue,regenerateRecoveryCodes:me,disableTwoFactorAuthentication:fe}}}),ye={key:0,class:"text-lg font-medium text-gray-900"},he={key:1,class:"text-lg font-medium text-gray-900"},ge={key:2,class:"text-lg font-medium text-gray-900"},we=i("div",{class:"mt-3 max-w-xl text-sm text-gray-600"},[i("p",null," When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application. ")],-1),_e={key:3},be={key:0},ve={class:"mt-4 max-w-xl text-sm text-gray-600"},Ce={key:0,class:"font-semibold"},ke={key:1},Fe=["innerHTML"],Te={key:0,class:"mt-4 max-w-xl text-sm text-gray-600"},Se={class:"font-semibold"},Ae=["innerHTML"],Be={key:1,class:"mt-4"},Ie={key:1},$e=i("div",{class:"mt-4 max-w-xl text-sm text-gray-600"},[i("p",{class:"font-semibold"}," Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost. ")],-1),Pe={class:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 rounded-lg"},Ee={class:"mt-5"},Ke={key:0},Ve={key:1};function Re(e,u,f,p,a,_){const T=d("InputLabel"),b=d("TextInput"),g=d("InputError"),y=d("a-button"),l=d("ConfirmsPassword"),S=d("PrimaryButton"),A=d("SecondaryButton"),Q=d("DangerButton"),O=d("ActionSection");return o(),h(O,{class:"mt-2"},{title:t(()=>[r(" Two Factor Authentication ")]),description:t(()=>[r(" Add additional security to your account using two factor authentication. ")]),content:t(()=>[e.twoFactorEnabled&&!e.confirming?(o(),n("h3",ye," You have enabled two factor authentication. ")):e.twoFactorEnabled&&e.confirming?(o(),n("h3",he," Finish enabling two factor authentication. ")):(o(),n("h3",ge," You have not enabled two factor authentication. ")),we,e.twoFactorEnabled?(o(),n("div",_e,[e.qrCode?(o(),n("div",be,[i("div",ve,[e.confirming?(o(),n("p",Ce," To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code. ")):(o(),n("p",ke," Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key. "))]),i("div",{class:"mt-4 p-2 inline-block bg-white",innerHTML:e.qrCode},null,8,Fe),e.setupKey?(o(),n("div",Te,[i("p",Se,[r(" Setup Key: "),i("span",{innerHTML:e.setupKey},null,8,Ae)])])):c("",!0),e.confirming?(o(),n("div",Be,[s(T,{for:"code",value:"Code"}),s(b,{id:"code",modelValue:e.confirmationForm.code,"onUpdate:modelValue":u[0]||(u[0]=v=>e.confirmationForm.code=v),type:"text",name:"code",class:"block mt-1 w-1/2",inputmode:"numeric",autofocus:"",autocomplete:"one-time-code",onKeyup:K(e.confirmTwoFactorAuthentication,["enter"])},null,8,["modelValue","onKeyup"]),s(g,{message:e.confirmationForm.errors.code,class:"mt-2"},null,8,["message"])])):c("",!0)])):c("",!0),e.recoveryCodes.length>0&&!e.confirming?(o(),n("div",Ie,[$e,i("div",Pe,[(o(!0),n(X,null,Z(e.recoveryCodes,v=>(o(),n("div",{key:v},C(v),1))),128))])])):c("",!0)])):c("",!0),i("div",Ee,[e.twoFactorEnabled?(o(),n("div",Ve,[s(l,{onConfirmed:e.confirmTwoFactorAuthentication},{default:t(()=>[e.confirming?(o(),h(S,{key:0,type:"button",class:w(["me-3",{"opacity-25":e.enabling}]),disabled:e.enabling},{default:t(()=>[r(" Confirm ")]),_:1},8,["class","disabled"])):c("",!0)]),_:1},8,["onConfirmed"]),s(l,{onConfirmed:e.regenerateRecoveryCodes},{default:t(()=>[e.recoveryCodes.length>0&&!e.confirming?(o(),h(A,{key:0,class:"me-3"},{default:t(()=>[r(" Regenerate Recovery Codes ")]),_:1})):c("",!0)]),_:1},8,["onConfirmed"]),s(l,{onConfirmed:e.showRecoveryCodes},{default:t(()=>[e.recoveryCodes.length===0&&!e.confirming?(o(),h(A,{key:0,class:"me-3"},{default:t(()=>[r(" Show Recovery Codes ")]),_:1})):c("",!0)]),_:1},8,["onConfirmed"]),s(l,{onConfirmed:e.disableTwoFactorAuthentication},{default:t(()=>[e.confirming?(o(),h(A,{key:0,class:w({"opacity-25":e.disabling}),disabled:e.disabling},{default:t(()=>[r(" Cancel ")]),_:1},8,["class","disabled"])):c("",!0)]),_:1},8,["onConfirmed"]),s(l,{onConfirmed:e.disableTwoFactorAuthentication},{default:t(()=>[e.confirming?c("",!0):(o(),h(Q,{key:0,class:w({"opacity-25":e.disabling}),disabled:e.disabling},{default:t(()=>[r(" Disable ")]),_:1},8,["class","disabled"]))]),_:1},8,["onConfirmed"])])):(o(),n("div",Ke,[s(l,{onConfirmed:e.enableTwoFactorAuthentication},{default:t(()=>[s(y,{type:"primary","html-type":"submit",class:w([{"opacity-25":e.enabling},"login-form-button"]),disabled:e.enabling},{default:t(()=>[r("Enable")]),_:1},8,["class","disabled"])]),_:1},8,["onConfirmed"])]))])]),_:1})}const ze=se(pe,[["render",Re]]);export{ze as default};
